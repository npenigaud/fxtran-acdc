MODULE STACK_MOD

#ifdef _OPENACC
USE OPENACC, ONLY : ACC_DEVICEPTR
#endif

#include "stack.macros.h"

IMPLICIT NONE

TYPE STACK_DATA
  REAL (KIND=4), POINTER :: ZDATA4 (:,:,:,:)
  REAL (KIND=8), POINTER :: ZDATA8 (:,:,:,:)
  INTEGER*8 :: IALIGN
CONTAINS
END TYPE

TYPE STACK
  INTEGER*8 :: L4
  INTEGER*8 :: U4
  INTEGER*8 :: L8
  INTEGER*8 :: U8
END TYPE

TYPE (STACK_DATA) :: YSTACK
PUBLIC :: STACK, YSTACK, GET_STACK

CONTAINS

TYPE (STACK) FUNCTION GET_STACK (LDACC) RESULT (YLSTACK)

LOGICAL, INTENT (IN) :: LDACC

YLSTACK%L4 = devaddr (YSTACK%ZDATA4 (1, 1, 1, 1), LDACC)
YLSTACK%U4 = YLSTACK%L4 + SIZE (YSTACK%ZDATA4, KIND=8) * KIND (YSTACK%ZDATA4)
YLSTACK%L8 = devaddr (YSTACK%ZDATA8 (1, 1, 1, 1), LDACC)
YLSTACK%U8 = YLSTACK%L8 + SIZE (YSTACK%ZDATA8, KIND=8) * KIND (YSTACK%ZDATA8)

END FUNCTION

END MODULE

